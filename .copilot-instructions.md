# Copilot Instructions - Parrao Weather Web

## Descripción del Proyecto
Aplicación web Flask para obtener y mostrar datos de una estación meteorológica personal utilizando las APIs de Weather Underground y EcoWitt.

## Arquitectura
- **Framework**: Flask (Python web framework)
- **Deployment**: Google Cloud Platform (App Engine)
- **APIs Integradas**: 
  - Weather Underground API (wunderground.com)
  - EcoWitt API (ecowitt.net)
- **Testing**: pytest con coverage (objetivo: 100%)

## Estructura del Proyecto
```
parrao_weather_web/
├── main.py              # Punto de entrada de la aplicación
├── src/                 # Código fuente principal
│   ├── web.py          # Aplicación Flask y rutas
│   ├── weather.py      # Lógica de interacción con APIs meteorológicas
│   ├── config.py       # Configuración de la aplicación
│   ├── logger.py       # Sistema de logging
│   └── utils.py        # Utilidades generales
├── templates/          # Templates HTML (Jinja2)
├── static/             # Archivos estáticos (CSS, JS, imágenes)
├── tests/              # Tests unitarios
├── requirements.txt    # Dependencias de producción
└── requirements-tests.txt  # Dependencias de desarrollo/testing
```

## Reglas de Desarrollo

### Estilo de Código
1. Seguir PEP 8 para estilo de código Python
2. Usar type hints cuando sea posible
3. Documentar funciones con docstrings
4. Mantener funciones pequeñas y con una única responsabilidad

### Testing
1. **Cobertura**: Mantener 100% de test coverage
2. **Framework**: Usar pytest para todos los tests
3. **Comando**: `coverage run -m pytest -v && coverage html --omit=*/venv/*,*/tests/*`
4. **Ubicación**: Todos los tests en el directorio `tests/`
5. **Nombrado**: Tests deben seguir el patrón `test_*.py`

### Variables de Entorno
Usar siempre `.env` para configuración sensible (nunca commitear):
- `ENV_PRO`: N (desarrollo) o Y (producción)
- `LEVEL_LOG`: INFO, WARNING, ERROR
- `API_KEY_WUNDERGROUND`: Clave API de Weather Underground
- `STATION_ID`: ID de la estación meteorológica
- `API_KEY_ECOWITT`: Clave API de EcoWitt
- `APPLICATION_KEY`: Clave de aplicación EcoWitt
- `STATION_MAC`: MAC de la estación

### Logging
- Usar el módulo `logger.py` personalizado
- Configurar nivel según `LEVEL_LOG` en `.env`
- Logs informativos en desarrollo, solo errores en producción

### Deployment
- **Plataforma**: Google Cloud Platform App Engine
- **Comando**: `gcloud app deploy`
- **Configuración**: `app.yaml`

## Buenas Prácticas

### Cuando hagas cambios:
1. **Siempre** actualizar tests si modificas funcionalidad
2. **Verificar** que los tests pasen antes de commitear
3. **Mantener** la cobertura al 100%
4. **No exponer** claves API o credenciales
5. **Usar** manejo de errores apropiado para llamadas API
6. **Validar** datos de entrada de usuarios
7. **Documentar** funciones nuevas o modificadas

### APIs Externas
- Implementar manejo de errores robusto (timeouts, rate limits)
- Cachear respuestas cuando sea apropiado
- Validar datos recibidos de las APIs
- Logging de errores de API para debugging

### Flask Best Practices
- Usar blueprints si la aplicación crece
- Validar y sanitizar inputs de usuarios
- Implementar CSRF protection si hay formularios
- Usar sessions de forma segura

## Comandos Útiles

### Desarrollo
```bash
# Instalar dependencias
pip install -r requirements.txt
pip install -r requirements-tests.txt

# Ejecutar app localmente
flask run

# Ejecutar tests con coverage
./check_app.sh
# o
coverage run -m pytest -v && coverage html --omit=*/venv/*,*/tests/*

# Ver reporte de coverage
open htmlcov/index.html
```

### Deployment
```bash
# Deploy a GCP
gcloud app deploy

# Ver logs
gcloud app logs tail -s default
```

## Referencias Externas
- [Documentación API EcoWitt](https://doctest.ecowitt.net/web/#/apiv3en?page_id=17)
- [Documentación API Weather Underground](https://ibm.co/v2PWSCC)
- [Icons (icons8)](https://icons8.com/)

## Notas Importantes
- La aplicación está en producción en: https://richionline-portfolio.nw.r.appspot.com
- Versión actual: 1.0.5
- Python 3.10+
- Mantener compatibilidad con App Engine standard environment
